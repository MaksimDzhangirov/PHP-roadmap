[Оригинал](https://roadmap.sh/best-practices/api-security)

# Рекомендации по защите API

## Аутентификация

### Избегайте «базовой аутентификации» ('Basic Authentication'), используйте стандарты (например, JWT)
### Не изобретайте велосипед в механизмах аутентификации
### Используйте максимальное число неудачных попыток ('Max Retry') и функционал, осуществляющий блокировку, при определённом числе неудачных входов в систему
### Используйте шифрование для всех конфиденциальных данных

## JWT (JSON веб-токен)

### Используйте такой «JWT секретный ключ» ('JWT Secret'), который усложнит его подбор атакой методом «грубой силой» (полным перебором)

> Позаботьтесь о хорошем секретный ключе для JWT для защиты от внесения злонамеренных изменений в токен (подделки токена), а также для предотвращения атак методом «грубой силы».

Надёжный секретный ключ должен генерироваться случайным образом, быть длинным и сложным, храниться в надежном месте и периодически меняться.

### Не извлекайте алгоритм из заголовка запроса, используйте бэкенд

Извлечение алгоритма из заголовка JWT токена может представлять угрозу безопасности, поскольку злоумышленник может изменить алгоритм и потенциально получить несанкционированный доступ. Поэтому рекомендуется проверять алгоритм, используя бэкенд, а не извлекать его из заголовка. Это поможет гарантировать, что алгоритм, используемый для подписи и проверки токена, безопасен и не был подделан.

### Делайте срок действия токена (TTL, RTTL) как можно короче
### Избегайте хранения конфиденциальных данных в полезной нагрузке JWT

Хранение конфиденциальных данных в полезной нагрузке JWT токена может увеличить риск утечки данных и других ситуаций, связанных с нарушением безопасности. Если злоумышленник сможет раздобыть или подделать токен, он потенциально может получить доступ к конфиденциальным данным, хранящимся в полезных данных.

### Старайтесь сделать полезную нагрузку небольшой, чтобы уменьшить размер JWT токена

## Контроль доступа

### Ограничивайте число запросов (ограничение пропускной способности, throttling), чтобы избежать DDoS атак / атакой методом «грубой силой»
### Используйте HTTPS на стороне сервера и безопасные алгоритмы шифрования
### Используйте заголовок HSTS с SSL, чтобы избежать атак SSL Strip
### Отключите вывод списка каталогов
### Приватные API должны быть доступны только для «безопасного» списка IP-адресов

## OAuth

### Всегда проверяйте 'redirect_uri' на стороне сервера
### Не используйте 'response_type=token', а вместо него применяйте поток с кодом подтверждения
### Используйте параметр 'state' для предотвращения CSRF атак
### У вас должна быть «набор запрашиваемых у пользователя разрешений на доступ к данным» (scope) по умолчанию и необходимо проверять его для каждого приложения


## Обработка

### Проверьте для всех ли конечных точек с доступом только для аутентифицированных пользователей выполняется процесс аутентификации, чтобы избежать нарушения процесса аутентификации
### Избегайте использования идентификатора пользователя в URL-адресах ресурсов, например, `users/242/orders`
### Предпочитайте использовать UUID вместо автоинкрементных идентификаторов
### Отключите парсинг поступающих извне XML сущностей, если вы парсите XML, чтобы избежать XXE атак
### Отключите расширения, позволяющие обрабатывать поступающие извне сущности, если вы используете XML, YML или любой другой язык
### Используйте CDN для загрузки файлов
### Избегайте ситуаций, когда часть HTTP запросов не может быть выполнена из-за большого объёма данных
### Обязательно отключите режим отладки на продакшене
### Используйте Non-Executable Stacks, когда это возможно

## Обработка входных данных

### Используйте HTTP-метод, соответствующий осуществляемой операции
### Проверяйте `content-type` в заголовке запроса
### Проверяйте вводимые пользователем данные, чтобы избежать распространенных уязвимостей
### Используйте стандартный заголовок `Authorization` для конфиденциальных данных
### Используйте только шифрование на стороне сервера
### Используйте API шлюз для кэширования, правила, ограничивающие число запросов к ресурсу за определённый период времени и т. д.

## Обработка выходных данных

### Отправляйте заголовок `X-Content-Type-Options: nosniff`
### Отправляйте заголовок `X-Frame-Options: Deny`
### Отправляйте заголовок `Content-Security-Policy: default-src 'none'`
### Удалите заголовки, которые могут облегчить идентификацию сервера (например, `x-powered-by` и т. д.)
### Принудительно задавайте `content-type` для вашего ответа
### Избегайте передачи в ответе конфиденциальных данных (учетных данных, аутентификационных токенов и т. д.)
### Возвращайте правильные коды ответа в соответствии с операцией

## CI & CD

## Мониторинг

## Список рекомендованных ссылок по теме

* [Collection of Resources for Building APIs](https://github.com/yosriady/awesome-api-devtools)
* [CS253: Web Security](https://www.youtube.com/watch?v=5JJrJGZ_LjM&list=PL1y1iaEtjSYiiSGVlL1cHsXN_kvJOOhu-)
* [Securing Web Applications](https://www.youtube.com/watch?v=WlmKwIe9z1Q)
* [MIT 6.858: Computer Systems Security](https://www.youtube.com/watch?v=GqmQg-cszw4&list=PLUl4u3cNGP62K2DjQLRxDNRi0z2IRWnNh)
